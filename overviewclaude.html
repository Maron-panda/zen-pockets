<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Zen Pockets Overview</title>
  <link rel="stylesheet" href="overviewclaude.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Noto+Sans+JP:wght@300;400;500&display=swap" rel="stylesheet"> 
</head>
  
<body>
  <div class="container">
    <h1>üêº Zen Pockets</h1> 
    <p class="subtitle">Momorin reporting for duty!</p>

    <!-- Mascot Section -->
    <div class="mascot"> 
      <img src="momorin-placeholder.png" alt="Momorin the Mascot"> 
    </div> 
    
    <!-- Toggle Switch and Label -->
    <div id="toggleContainer">
      <span id="toggleLabel">Monthly View</span>
      <label class="switch">
        <input type="checkbox" id="viewToggle">
        <span class="slider round"></span>
      </label>
    </div>

    <!-- Data Table -->
    <table id="dataTable">
      <thead>
        <tr>
          <th>Category</th>
          <th id="amountHeader">This Month</th>
          <th>Last Pay</th>
        </tr>
      </thead>
      
      <tbody id="tableBody">
        <!-- Data will be populated here -->
      </tbody>
    </table>

    <!-- Extra Info will be added dynamically -->
    <div id="extraInfo"></div>

    <!-- Achievements Section -->
    <div class="achievements">
      <div class="achievement-card" style="--delay: 1">
        <h3>ü¶ä Cunning Fox</h3>
        <p>"Got 33333 in fond"</p>
      </div>
      <div class="achievement-card" style="--delay: 2">
        <h3>üê∞ Burrowing bunny</h3>
        <p>"Some bunnies make good points. You're saving 50000 for the future"</p>
      </div>
      <div class="achievement-card" style="--delay: 3">
        <h3>üêº Free Panda</h3>
        <p>"Payed down 50000 debt"</p>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  
  <script>
    //For the fetching and table. Do not touch it, it's hanging by a very thin thread
    const viewToggle = document.getElementById('viewToggle');
    const toggleLabel = document.getElementById('toggleLabel');
    const tableBody = document.getElementById('tableBody');
    const amountHeader = document.getElementById('amountHeader');
    const extraInfo = document.getElementById('extraInfo');

    let data = [];

    fetch('https://script.google.com/macros/s/AKfycbwpZk0uPc5wRGvo5qKuE7ZUhUanft_Ax45erylAuvGqoj4B_Dp0YDR6hkKYqYPm-Qzp3g/exec')
      .then(response => response.json())
      .then(json => {
        data = json;
        populateTable('monthly');
        updateExtraInfo();
      });

    viewToggle.addEventListener('change', () => {
      const view = viewToggle.checked ? 'total' : 'monthly';
      toggleLabel.textContent = viewToggle.checked ? 'Total View' : 'Monthly View';
      amountHeader.textContent = viewToggle.checked ? 'Total' : 'This Month';
      populateTable(view);
    });

    function populateTable(view) {
      tableBody.innerHTML = '';
      const isTotalView = view === 'total';
      const source = isTotalView ? data.totalView : data.overview[data.overview.length - 1];
      const categories = [
        { key: 'Loan', label: 'Loan' },
        { key: 'Savings', label: 'Savings' },
        { key: 'Charity', label: 'Charity' },
        { key: 'Fond', label: 'Fond' },
        { key: 'FreeUse', label: 'Free Use' }
      ];
      
      categories.forEach(cat => {
        const row = document.createElement('tr');
        const categoryCell = document.createElement('td');
        categoryCell.textContent = cat.label;

        const amountCell = document.createElement('td');
        const lastPayCell = document.createElement('td');

        amountCell.textContent = `${source[cat.key]} NOK`;
        lastPayCell.textContent = `${data.lastPay[cat.key]} NOK`;

        row.appendChild(categoryCell);
        row.appendChild(amountCell);
        row.appendChild(lastPayCell);
        tableBody.appendChild(row);
      });

      // Total row
      const totalRow = document.createElement('tr');
      totalRow.classList.add('total-row');

      const totalLabelCell = document.createElement('td');
      totalLabelCell.textContent = 'Total';

      const totalAmountCell = document.createElement('td');
      totalAmountCell.textContent = `${isTotalView ? source.Total : source.total} NOK`;

      const totalLastPayCell = document.createElement('td');
      totalLastPayCell.textContent = `${data.lastPay.Total} NOK`;

      totalRow.appendChild(totalLabelCell);
      totalRow.appendChild(totalAmountCell);
      totalRow.appendChild(totalLastPayCell);
      tableBody.appendChild(totalRow);
    }

    function updateExtraInfo() {
      // Clear previous extras
      extraInfo.innerHTML = '';

      // Add rounding buffer
      const roundingNote = document.createElement('p');
      roundingNote.className = 'footnote';
      roundingNote.textContent = `* Rounding buffer is currently ${data.totalView.roundingBuffer} NOK.`;
      extraInfo.appendChild(roundingNote);

      // Add Momorin message
      const paysThisMonth = data.overview[data.overview.length - 1].payCount;
      const momorinMsg = document.createElement('p');
      momorinMsg.textContent = `Momorin üêæ: You have in total ${paysThisMonth} pays this month!`;
      extraInfo.appendChild(momorinMsg);
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }
  </script>

  <!-- Sakura Canvas Animation -->
  <canvas id="sakura-canvas" class="sakura-canvas"></canvas>
  
  <script>
    // Custom lightweight sakura animation (adapted from working form page)
    class SakuraAnimation {
      constructor() {
        this.canvas = document.getElementById('sakura-canvas');
        this.ctx = this.canvas.getContext('2d');
        this.petals = [];
        this.init();
      }

      init() {
        this.resize();
        this.createPetals();
        this.animate();
        
        window.addEventListener('resize', () => this.resize());
      }

      resize() {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
      }

      createPetals() {
        const petalCount = window.innerWidth < 768 ? 20 : 35; // More petals for overview page
        
        for (let i = 0; i < petalCount; i++) {
          this.petals.push({
            x: Math.random() * this.canvas.width,
            y: Math.random() * this.canvas.height - this.canvas.height,
            size: Math.random() * 6 + 3, // Smaller, more delicate petals
            speedX: (Math.random() - 0.5) * 1.5,
            speedY: Math.random() * 1.5 + 0.8,
            rotation: Math.random() * 360,
            rotationSpeed: (Math.random() - 0.5) * 3,
            opacity: Math.random() * 0.4 + 0.2, // More translucent
            color: this.getRandomPetalColor()
          });
        }
      }

      getRandomPetalColor() {
        const colors = [
          '#e8d5d0', // Soft blush
          '#e8f4f0', // Gentle mint
          '#f4e8e8', // Warm pink
          '#f0f4e8', // Soft sage
          '#f8f0f4'  // Cream pink
        ];
        return colors[Math.floor(Math.random() * colors.length)];
      }

      drawPetal(petal) {
        this.ctx.save();
        this.ctx.translate(petal.x, petal.y);
        this.ctx.rotate(petal.rotation * Math.PI / 180);
        this.ctx.globalAlpha = petal.opacity;
        
        // Delicate petal shape
        this.ctx.fillStyle = petal.color;
        this.ctx.beginPath();
        this.ctx.ellipse(0, 0, petal.size, petal.size * 0.7, 0, 0, Math.PI * 2);
        this.ctx.fill();
        
        // Add subtle highlight
        this.ctx.globalAlpha = petal.opacity * 0.3;
        this.ctx.fillStyle = '#ffffff';
        this.ctx.beginPath();
        this.ctx.ellipse(-petal.size * 0.3, -petal.size * 0.2, petal.size * 0.4, petal.size * 0.3, 0, 0, Math.PI * 2);
        this.ctx.fill();
        
        this.ctx.restore();
      }

      animate() {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        
        for (let petal of this.petals) {
          petal.x += petal.speedX;
          petal.y += petal.speedY;
          petal.rotation += petal.rotationSpeed;
          
          // Reset petal when it goes off screen
          if (petal.y > this.canvas.height + 20) {
            petal.y = -20;
            petal.x = Math.random() * this.canvas.width;
          }
          
          if (petal.x > this.canvas.width + 20) {
            petal.x = -20;
          } else if (petal.x < -20) {
            petal.x = this.canvas.width + 20;
          }
          
          this.drawPetal(petal);
        }
        
        requestAnimationFrame(() => this.animate());
      }
    }

    // Initialize sakura animation when page loads
    window.addEventListener('load', function() {
      new SakuraAnimation();
    });
  </script>

  <!-- Floating Panda Link to Reading Pavilion -->
  <a href="form.html" id="pandaReturn" title="Back to Reading Pavilion">
    <img src="images/panda-writing.png" alt="Return to Reading Pavilion">
  </a>

  <!-- Floating Letters Animation Container -->
  <div class="floating-letters"></div>

</body>
</html>
